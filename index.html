<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ç†±é‡ç²¾ç®—å¸« - AI Calorie Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            padding: 15px 20px;
            flex-shrink: 0;
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 60px;
            position: relative;
        }

        .header .logo {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: contain;
            background: transparent;
            padding: 4px;
            position: absolute;
            top: -20px;
            left: 15px;
            z-index: 1000;
            border: none;
        }

        .header-text {
            text-align: center;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .header-text h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
            text-align: center;
            margin-left: 2px;
        }

        .header-text p {
            font-size: 14px;
            opacity: 0.9;
            text-align: center;
            margin-left: 6px;
        }

        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .welcome-card {
            background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .welcome-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .welcome-desc {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .setup-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .setup-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .calorie-summary {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: none;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
            color: #333;
        }

        .target-display {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 16px;
        }

        .target-calories {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .calorie-unit {
            font-size: 18px;
            font-weight: 500;
            opacity: 0.9;
        }

        .target-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-section {
            margin-bottom: 16px;
        }

        .progress-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .progress-bar {
            background: #F2F2F7;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #FF9500 0%, #34C759 100%);
            height: 100%;
            width: 0%;
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-percentage {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: 600;
            color: #666;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .stat {
            text-align: center;
            padding: 12px;
            background: #F8F9FA;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #007AFF;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .stat-value .unit {
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .status-message {
            background: #E3F2FD;
            border-left: 4px solid #007AFF;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #1976D2;
        }

        .quick-actions {
            margin-bottom: 20px;
        }

        .quick-actions h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
        }

        .primary-action {
            background: linear-gradient(135deg, #FF9500 0%, #FF6B35 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(255, 149, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.4);
        }

        .camera-icon {
            font-size: 48px;
            margin-bottom: 12px;
            display: block;
        }

        .primary-action h3 {
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .primary-action p {
            font-size: 14px;
            opacity: 0.9;
        }

        .secondary-action {
            background: white;
            border: 1px solid #E5E5E7;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 12px;
        }

        .secondary-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #007AFF;
        }

        .secondary-action .icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .secondary-action .title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .secondary-action .desc {
            font-size: 12px;
            color: #666;
        }

        .recent-foods {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: none;
        }

        .recent-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F2F2F7;
        }

        .food-item:last-child {
            border-bottom: none;
        }

        .food-info {
            flex: 1;
        }

        .food-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .food-time {
            font-size: 12px;
            color: #666;
        }

        .food-calories {
            font-size: 14px;
            font-weight: 600;
            color: #FF9500;
        }

        .ai-tip-section {
            background: linear-gradient(135deg, #5856D6 0%, #AF52DE 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .ai-tip-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .ai-icon {
            font-size: 24px;
            margin-right: 8px;
        }

        .ai-tip-title {
            font-size: 16px;
            font-weight: 600;
        }

        .ai-tip-content {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .bottom-nav {
            background: white;
            border-top: 1px solid #E5E5E7;
            padding: 12px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-shrink: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .nav-item:hover {
            background: #F2F2F7;
        }

        .nav-item.active {
            background: #E3F2FD;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            color: #666;
        }

        .nav-item.active .nav-label {
            color: #007AFF;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 14px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="ctx-logo.png" alt="LOGO" class="logo">
            <div class="header-content">
                <div class="header-text">
                    <h1>ğŸ æ¯æ—¥ç†±é‡ç²¾ç®—å¸«</h1>
                    <p>AIé©…å‹•çš„æ™ºèƒ½ç‡Ÿé¤Šç®¡ç†</p>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- æ­¡è¿å¡ç‰‡ - å¼•å°ç”¨æˆ¶è¨­å®š -->
            <div class="welcome-card" id="welcomeCard">
                <div class="welcome-title">ğŸ¯ é–‹å§‹æ‚¨çš„å¥åº·ä¹‹æ—…</div>
        <div class="welcome-desc">
            ç‚ºäº†çµ¦æ‚¨æœ€è²¼å¿ƒçš„ç‡Ÿé¤Šå»ºè­°ï¼Œè«‹å…ˆè¨­å®šæ‚¨çš„å€‹äººè³‡æ–™ï¼ŒAIå°‡æ ¹æ“šåœ‹éš›é†«å­¸æ¨™æº–ç‚ºæ‚¨æ¨è–¦æ¯æ—¥ç†±é‡ç›®æ¨™èˆ‡é£²é£Ÿè¨ˆåŠƒã€‚
        </div>
                <button class="setup-btn" onclick="openProfileSetup()">
                    ğŸ“ è¨­å®šå€‹äººè³‡æ–™
                </button>
            </div>

            <!-- ç†±é‡æ‘˜è¦ - è¨­å®šå¾Œé¡¯ç¤º -->
            <div class="calorie-summary" id="calorieSummary">
                <div class="summary-title">ğŸ“Š ä»Šæ—¥ç†±é‡ç‹€æ³</div>
                
                <div class="target-display">
                    <div class="target-calories" id="targetCalories">2,505<span class="calorie-unit">å¡è·¯é‡Œ</span></div>
                    <div class="target-label">AIå»ºè­°æ‚¨æ¯æ—¥æ”å–çš„ç†±é‡</div>
                </div>

                <div class="progress-section">
                    <div class="progress-title">é€²åº¦è¿½è¹¤</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                        <div class="progress-percentage" id="progressPercent">0%</div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="consumedCalories">0 <span class="unit">å¡</span></div>
                            <div class="stat-label">å·²æ”å–</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="remainingCalories">2,505 <span class="unit">å¡</span></div>
                            <div class="stat-label">å‰©é¤˜</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="targetCaloriesDisplay">2,505 <span class="unit">å¡</span></div>
                            <div class="stat-label">ç›®æ¨™</div>
                        </div>
                    </div>
                </div>

                <div class="status-message" id="statusMessage">
                    ğŸ’¡ é–‹å§‹è¨˜éŒ„æ‚¨çš„ç¬¬ä¸€é¤å§ï¼é»æ“Šä¸‹æ–¹æ‹ç…§è­˜åˆ¥åŠŸèƒ½é–‹å§‹è¿½è¹¤ã€‚
                </div>
            </div>

            <div class="quick-actions">
                <h2>ğŸ“¸ è¨˜éŒ„é£Ÿç‰©</h2>
                
                <!-- ä¸»è¦æ“ä½œï¼šæ‹ç…§è­˜åˆ¥ -->
                <div class="primary-action" onclick="openCamera()">
                    <span class="camera-icon">ğŸ“¸</span>
                    <h3>æ‹ç…§è­˜åˆ¥é£Ÿç‰©</h3>
                    <p>ç›´æ¥æ‹ç…§ï¼ŒAIè‡ªå‹•è­˜åˆ¥ç‡Ÿé¤Šæˆåˆ†</p>
                </div>

                <!-- æ¬¡è¦æ“ä½œ -->
                <div class="secondary-action" onclick="openUpload()">
                    <span class="icon">ğŸ“·</span>
                    <div class="title">ä¸Šå‚³åœ–ç‰‡</div>
                    <div class="desc">å¾ç›¸ç°¿é¸æ“‡åœ–ç‰‡è­˜åˆ¥</div>
                </div>

                <div class="secondary-action" onclick="quickAddFood()">
                    <span class="icon">â•</span>
                    <div class="title">å¿«é€Ÿæ·»åŠ </div>
                    <div class="desc">æ‰‹å‹•è¨˜éŒ„é£Ÿç‰©</div>
                </div>
            </div>

            <!-- æœ€è¿‘è¨˜éŒ„çš„é£Ÿç‰© -->
            <div class="recent-foods" id="recentFoods">
                <div class="recent-title">ğŸ½ï¸ ä»Šæ—¥é¤é£Ÿ</div>
                <div id="recentFoodsList">
                    <!-- å‹•æ…‹æ·»åŠ é£Ÿç‰©é …ç›® -->
                </div>
            </div>

            <!-- AIå»ºè­° -->
            <div class="ai-tip-section">
                <div class="ai-tip-header">
                    <span class="ai-icon">ğŸ¤–</span>
                    <span class="ai-tip-title">AIç‡Ÿé¤Šå»ºè­°</span>
                </div>
                <div class="ai-tip-content" id="aiTipContent">
                    è«‹å…ˆè¨­å®šæ‚¨çš„å€‹äººè³‡æ–™ï¼ŒAIå°‡ç‚ºæ‚¨æä¾›å€‹æ€§åŒ–çš„ç‡Ÿé¤Šå»ºè­°å’Œå¥åº·æŒ‡å°ã€‚
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å°èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-label">é¦–é </span>
            </div>
            <div class="nav-item" onclick="showFoodLog()">
                <span class="nav-icon">ğŸ“</span>
                <span class="nav-label">è¨˜éŒ„</span>
            </div>
            <div class="nav-item" onclick="showNutrition()">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">åˆ†æ</span>
            </div>
            <div class="nav-item" onclick="showProfile()">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-label">æˆ‘çš„</span>
            </div>
        </div>
    </div>

    <!-- å€‹äººè³‡æ–™è¨­å®šé é¢ -->
    <div id="profileSetupModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px;">
        <div style="background: white; padding: 30px; border-radius: 16px; width: 100%; max-width: 350px; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 20px; text-align: center; font-size: 20px;">ğŸ“ è¨­å®šå€‹äººè³‡æ–™</h3>
            <p style="text-align: center; color: #666; margin-bottom: 24px; font-size: 14px;">
                æˆ‘å€‘å°‡æ ¹æ“šåœ‹éš›é†«å­¸æ¨™æº–ç‚ºæ‚¨ç²¾æº–è¨ˆç®—æ¯æ—¥ç†±é‡éœ€æ±‚
            </p>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">èº«é«˜ (cm)</label>
                <input type="number" id="setupHeight" placeholder="ä¾‹å¦‚ï¼š170" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">é«”é‡ (kg)</label>
                <input type="number" id="setupWeight" placeholder="ä¾‹å¦‚ï¼š65" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">å¹´é½¡</label>
                <input type="number" id="setupAge" placeholder="ä¾‹å¦‚ï¼š28" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">æ€§åˆ¥</label>
                <select id="setupGender" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    <option value="">è«‹é¸æ“‡æ€§åˆ¥</option>
                    <option value="male">ç”·æ€§</option>
                    <option value="female">å¥³æ€§</option>
                </select>
            </div>

            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">æ´»å‹•é‡</label>
                <select id="setupActivity" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    <option value="">è«‹é¸æ“‡æ´»å‹•é‡</option>
                    <option value="1.2">ä¹…åä¸å‹• (è¾¦å…¬å®¤å·¥ä½œ)</option>
                    <option value="1.375">è¼•åº¦æ´»å‹• (æ¯é€±é‹å‹•1-3æ¬¡)</option>
                    <option value="1.55">ä¸­åº¦æ´»å‹• (æ¯é€±é‹å‹•3-5æ¬¡)</option>
                    <option value="1.725">é«˜åº¦æ´»å‹• (æ¯é€±é‹å‹•6-7æ¬¡)</option>
                    <option value="1.9">æ¥µé«˜æ´»å‹• (é«”åŠ›å·¥ä½œ+æ¯æ—¥é‹å‹•)</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="closeProfileSetup()" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                <button onclick="saveProfileSetup()" style="flex: 1; padding: 12px; border: none; border-radius: 8px; background: #007AFF; color: white; cursor: pointer; font-weight: 600;">å®Œæˆè¨­å®š</button>
            </div>
        </div>
    </div>

    <script>
        // ç”¨æˆ¶è³‡æ–™
        let userProfile = {
            height: null,
            weight: null,
            age: null,
            gender: null,
            activityLevel: null
        };

        let dailyCalories = {
            consumed: 0,
            target: 0,
            remaining: 0
        };

        // è¨ˆç®—æ¯æ—¥ç†±é‡éœ€æ±‚ (Harris-Benedictå…¬å¼)
        function calculateDailyCalories(height, weight, age, gender, activityLevel) {
            let bmr;
            if (gender === 'male') {
                bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }
            
            const dailyCalories = Math.round(bmr * parseFloat(activityLevel));
            return dailyCalories;
        }

        // æª¢æŸ¥æ˜¯å¦å·²è¨­å®šå€‹äººè³‡æ–™
        function checkProfileSetup() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                userProfile = JSON.parse(savedProfile);
                showCalorieSummary();
            } else {
                showWelcomeCard();
            }
        }

        // é¡¯ç¤ºæ­¡è¿å¡ç‰‡
        function showWelcomeCard() {
            document.getElementById('welcomeCard').style.display = 'block';
            document.getElementById('calorieSummary').style.display = 'none';
            document.getElementById('recentFoods').style.display = 'none';
        }

        // é¡¯ç¤ºç†±é‡æ‘˜è¦
        function showCalorieSummary() {
            document.getElementById('welcomeCard').style.display = 'none';
            document.getElementById('calorieSummary').style.display = 'block';
            
            // è¨ˆç®—æ¯æ—¥ç†±é‡éœ€æ±‚
            dailyCalories.target = calculateDailyCalories(
                userProfile.height, 
                userProfile.weight, 
                userProfile.age, 
                userProfile.gender,
                userProfile.activityLevel
            );
            dailyCalories.remaining = dailyCalories.target - dailyCalories.consumed;
            
            // æ›´æ–°ç•Œé¢
            updateCalorieDisplay();
            updateAITip();
            
            // å¦‚æœæœ‰é£Ÿç‰©è¨˜éŒ„ï¼Œé¡¯ç¤º
            if (dailyCalories.consumed > 0) {
                document.getElementById('recentFoods').style.display = 'block';
            }
        }

        // æ›´æ–°ç†±é‡é¡¯ç¤º
        function updateCalorieDisplay() {
            document.getElementById('targetCalories').innerHTML = dailyCalories.target.toLocaleString() + '<span class="calorie-unit">å¡è·¯é‡Œ</span>';
            document.getElementById('targetCaloriesDisplay').innerHTML = dailyCalories.target.toLocaleString() + ' <span class="unit">å¡</span>';
            document.getElementById('consumedCalories').innerHTML = dailyCalories.consumed.toLocaleString() + ' <span class="unit">å¡</span>';
            document.getElementById('remainingCalories').innerHTML = dailyCalories.remaining.toLocaleString() + ' <span class="unit">å¡</span>';
            
            // æ›´æ–°é€²åº¦æ¢
            const percentage = Math.round((dailyCalories.consumed / dailyCalories.target) * 100);
            document.getElementById('progressFill').style.width = Math.min(percentage, 100) + '%';
            document.getElementById('progressPercent').textContent = percentage + '%';
            
            // æ›´æ–°ç‹€æ…‹è¨Šæ¯
            updateStatusMessage(percentage);
        }

        // æ›´æ–°ç‹€æ…‹è¨Šæ¯
        function updateStatusMessage(percentage) {
            const statusElement = document.getElementById('statusMessage');
            let message = '';
            
            if (percentage === 0) {
                message = 'ğŸ’¡ é–‹å§‹è¨˜éŒ„æ‚¨çš„ç¬¬ä¸€é¤å§ï¼é»æ“Šä¸‹æ–¹æ‹ç…§è­˜åˆ¥åŠŸèƒ½é–‹å§‹è¿½è¹¤ã€‚';
            } else if (percentage < 30) {
                message = 'ğŸŒ… æ—©ä¸Šå¥½ï¼æ‚¨ä»Šå¤©é‚„æ²’æœ‰é–‹å§‹è¨˜éŒ„é£Ÿç‰©ï¼Œå¿«ä¾†æ‹ç…§è­˜åˆ¥æ‚¨çš„æ—©é¤å§ï¼';
            } else if (percentage < 60) {
                message = 'ğŸ½ï¸ å¾ˆå¥½ï¼æ‚¨å·²ç¶“è¨˜éŒ„äº†ä¸€äº›é£Ÿç‰©ï¼Œç¹¼çºŒä¿æŒï¼Œè¨˜å¾—è¨˜éŒ„åˆé¤å“¦ï¼';
            } else if (percentage < 80) {
                message = 'ğŸ‘ é€²åº¦ä¸éŒ¯ï¼æ‚¨å·²ç¶“å®Œæˆäº†å¤§éƒ¨åˆ†ç›®æ¨™ï¼Œæ™šé¤å¯ä»¥é¸æ“‡è¼•é£Ÿã€‚';
            } else if (percentage < 100) {
                message = 'ğŸ¯ å¿«å®Œæˆäº†ï¼æ‚¨å·²ç¶“æ¥è¿‘ä»Šæ—¥ç›®æ¨™ï¼Œå¯ä»¥é¸æ“‡ä¸€äº›å¥åº·çš„é»å¿ƒã€‚';
            } else {
                message = 'âš ï¸ æ‚¨å·²è¶…å‡ºä»Šæ—¥ç†±é‡ç›®æ¨™ï¼Œå»ºè­°å¢åŠ é‹å‹•é‡æˆ–èª¿æ•´æ˜æ—¥é£²é£Ÿè¨ˆåŠƒã€‚';
            }
            
            statusElement.textContent = message;
        }

        // æ›´æ–°AIå»ºè­°
        function updateAITip() {
            const percentage = Math.round((dailyCalories.consumed / dailyCalories.target) * 100);
            let tip = '';
            
            if (percentage === 0) {
                // æ ¹æ“šå¹´é½¡ã€æ€§åˆ¥ã€èº«é«˜é«”é‡æä¾›å€‹æ€§åŒ–å»ºè­°
                let personalizedTip = '';
                const bmi = userProfile.weight / Math.pow(userProfile.height / 100, 2);
                
                if (userProfile.age >= 50) {
                    personalizedTip = `æ ¹æ“šæ‚¨çš„å€‹äººè³‡æ–™ï¼ˆèº«é«˜${userProfile.height}cmï¼Œé«”é‡${userProfile.weight}kgï¼Œ${userProfile.age}æ­²${userProfile.gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§'}ï¼‰ï¼Œå»ºè­°å¤šæ”å–éˆ£è³ªè±å¯Œé£Ÿç‰©ï¼ˆå¦‚ç‰›å¥¶ã€è±†è…ï¼‰å’Œç¶­ç”Ÿç´ Dï¼Œé¿å…é«˜éˆ‰é£Ÿç‰©ã€‚æ¯å¤©é©åº¦é‹å‹•ï¼Œæ§åˆ¶ç³–åˆ†æ”å–ï¼Œæœ‰åŠ©æ–¼é é˜²éª¨è³ªç–é¬†ã€‚`;
                } else if (userProfile.age >= 30) {
                    personalizedTip = `æ ¹æ“šæ‚¨çš„å€‹äººè³‡æ–™ï¼ˆèº«é«˜${userProfile.height}cmï¼Œé«”é‡${userProfile.weight}kgï¼Œ${userProfile.age}æ­²${userProfile.gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§'}ï¼‰ï¼Œå»ºè­°å¢åŠ å„ªè³ªè›‹ç™½è³ªï¼ˆå¦‚é›èƒ¸è‚‰ã€é­šé¡ï¼‰å’Œå…¨ç©€é¡æ”å–ï¼Œé¿å…åŠ å·¥é£Ÿå“å’Œé«˜ç³–é£²æ–™ã€‚æ³¨æ„æ§åˆ¶ç²¾ç·»æ¾±ç²‰ï¼Œå¤šæ”å–æ·±è‰²è”¬èœã€‚`;
                } else {
                    personalizedTip = `æ ¹æ“šæ‚¨çš„å€‹äººè³‡æ–™ï¼ˆèº«é«˜${userProfile.height}cmï¼Œé«”é‡${userProfile.weight}kgï¼Œ${userProfile.age}æ­²${userProfile.gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§'}ï¼‰ï¼Œå»ºè­°å¤šæ”å–è¤‡åˆç¢³æ°´åŒ–åˆç‰©å’Œè±å¯Œè›‹ç™½è³ªï¼Œé¿å…éå¤šæ²¹ç‚¸é£Ÿç‰©å’Œå«ç³–é£²æ–™ã€‚è¨˜å¾—å¤šå–æ°´ï¼Œä¿æŒè¦å¾‹ä½œæ¯ï¼Œæœ‰åŠ©æ–¼èº«é«”ç™¼è‚²å’Œä»£è¬ã€‚`;
                }
                
                tip = personalizedTip;
            } else if (percentage < 50) {
                tip = `æ‚¨ç›®å‰å®Œæˆäº†${percentage}%çš„ç†±é‡æ”å–ã€‚å»ºè­°å¢åŠ å¥åº·é£Ÿç‰©çš„æ”å–ï¼Œå¦‚å…¨ç©€é¡ã€è›‹ç™½è³ªè±å¯Œçš„é£Ÿç‰©ï¼Œä»¥é”åˆ°æ¯æ—¥ç›®æ¨™ã€‚`;
            } else if (percentage < 80) {
                tip = `æ‚¨çš„ç†±é‡æ”å–é€²åº¦è‰¯å¥½ï¼ˆ${percentage}%ï¼‰ã€‚å»ºè­°æ™šé¤é¸æ“‡ç‡Ÿé¤Šå‡è¡¡çš„é£Ÿç‰©ï¼Œç¢ºä¿é”åˆ°æ¯æ—¥${dailyCalories.target}å¡è·¯é‡Œçš„ç›®æ¨™ã€‚`;
            } else if (percentage < 100) {
                tip = `æ‚¨å·²æ¥è¿‘å®Œæˆä»Šæ—¥ç›®æ¨™ï¼ˆ${percentage}%ï¼‰ã€‚å»ºè­°é¸æ“‡è¼•é£Ÿæˆ–è”¬èœç‚ºä¸»ï¼Œé¿å…éé‡æ”å–ã€‚`;
            } else {
                tip = `æ‚¨å·²è¶…å‡ºä»Šæ—¥ç†±é‡ç›®æ¨™ã€‚å»ºè­°å¢åŠ é‹å‹•é‡æˆ–èª¿æ•´æ˜æ—¥é£²é£Ÿè¨ˆåŠƒï¼Œä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ã€‚`;
            }
            
            document.getElementById('aiTipContent').textContent = tip;
        }

        // é–‹å•Ÿå€‹äººè³‡æ–™è¨­å®š
        function openProfileSetup() {
            document.getElementById('profileSetupModal').style.display = 'flex';
        }

        // é—œé–‰å€‹äººè³‡æ–™è¨­å®š
        function closeProfileSetup() {
            document.getElementById('profileSetupModal').style.display = 'none';
        }

        // ä¿å­˜å€‹äººè³‡æ–™è¨­å®š
        function saveProfileSetup() {
            const height = parseInt(document.getElementById('setupHeight').value);
            const weight = parseInt(document.getElementById('setupWeight').value);
            const age = parseInt(document.getElementById('setupAge').value);
            const gender = document.getElementById('setupGender').value;
            const activityLevel = document.getElementById('setupActivity').value;

            // é©—è­‰è¼¸å…¥
            if (!height || !weight || !age || !gender || !activityLevel) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                return;
            }

            if (height < 100 || height > 250) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„èº«é«˜ç¯„åœ (100-250cm)ï¼');
                return;
            }

            if (weight < 30 || weight > 200) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„é«”é‡ç¯„åœ (30-200kg)ï¼');
                return;
            }

            if (age < 10 || age > 100) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„å¹´é½¡ç¯„åœ (10-100æ­²)ï¼');
                return;
            }

            // ä¿å­˜è³‡æ–™
            userProfile = { height, weight, age, gender, activityLevel };
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            
            // é—œé–‰æ¨¡æ…‹æ¡†ä¸¦é¡¯ç¤ºæ‘˜è¦
            closeProfileSetup();
            showCalorieSummary();
            
            alert('âœ… å€‹äººè³‡æ–™è¨­å®šå®Œæˆï¼\n\nAIå·²æ ¹æ“šåœ‹éš›é†«å­¸æ¨™æº–ç‚ºæ‚¨ç²¾æº–è¨ˆç®—æ¯æ—¥ç†±é‡éœ€æ±‚ã€‚');
        }

        // ä¸»è¦åŠŸèƒ½
        function openCamera() {
            if (!userProfile.height) {
                alert('è«‹å…ˆè¨­å®šæ‚¨çš„å€‹äººè³‡æ–™ï¼');
                openProfileSetup();
                return;
            }
            // æ‹ç…§æ¨¡å¼
            window.location.href = 'camera.html?mode=camera';
        }

        function quickAddFood() {
            if (!userProfile.height) {
                alert('è«‹å…ˆè¨­å®šæ‚¨çš„å€‹äººè³‡æ–™ï¼');
                openProfileSetup();
                return;
            }
            alert('â• å¿«é€Ÿæ·»åŠ é£Ÿç‰©\n\næ‚¨å¯ä»¥ï¼š\nâ€¢ æœç´¢é£Ÿç‰©æ•¸æ“šåº«\nâ€¢ æ‰‹å‹•è¼¸å…¥ç‡Ÿé¤Šä¿¡æ¯\nâ€¢ é¸æ“‡å¸¸ç”¨é£Ÿç‰©\nâ€¢ è¨­å®šä»½é‡');
        }

        function openUpload() {
            if (!userProfile.height) {
                alert('è«‹å…ˆè¨­å®šæ‚¨çš„å€‹äººè³‡æ–™ï¼');
                openProfileSetup();
                return;
            }
            // ä¸Šå‚³æ¨¡å¼ - è·³è½‰åˆ°å°ˆé–€çš„ä¸Šå‚³é é¢
            window.location.href = 'upload.html';
        }

        function showFoodLog() {
            alert('ğŸ“ é£Ÿç‰©è¨˜éŒ„\n\næŸ¥çœ‹å’Œç®¡ç†ï¼š\nâ€¢ ä»Šæ—¥æ‰€æœ‰é¤é£Ÿ\nâ€¢ ç‡Ÿé¤Šæˆåˆ†è©³æƒ…\nâ€¢ ç·¨è¼¯å’Œåˆªé™¤è¨˜éŒ„\nâ€¢ æ­·å²è¨˜éŒ„æŸ¥è©¢');
        }

        function showNutrition() {
            alert('ğŸ“Š ç‡Ÿé¤Šåˆ†æ\n\nè©³ç´°åˆ†æï¼š\nâ€¢ ç‡Ÿé¤Šæˆåˆ†åœ–è¡¨\nâ€¢ èˆ‡ç›®æ¨™å°æ¯”\nâ€¢ è¶¨å‹¢åˆ†æ\nâ€¢ æ”¹å–„å»ºè­°');
        }

        function showProfile() {
            alert('ğŸ‘¤ å€‹äººæª”æ¡ˆ\n\nå€‹äººè¨­ç½®ï¼š\nâ€¢ åŸºæœ¬ä¿¡æ¯\nâ€¢ å¥åº·ç›®æ¨™\nâ€¢ åå¥½è¨­ç½®\nâ€¢ æ•¸æ“šå°å‡º');
        }

        // æ¨¡æ“¬æ·»åŠ é£Ÿç‰©
        function addFoodToLog(foodName, calories) {
            dailyCalories.consumed += calories;
            dailyCalories.remaining = dailyCalories.target - dailyCalories.consumed;
            
            // æ·»åŠ åˆ°æœ€è¿‘é£Ÿç‰©åˆ—è¡¨
            const foodsList = document.getElementById('recentFoodsList');
            const newFoodItem = document.createElement('div');
            newFoodItem.className = 'food-item';
            newFoodItem.innerHTML = `
                <div class="food-info">
                    <div class="food-name">${foodName}</div>
                    <div class="food-time">å‰›å‰›æ·»åŠ </div>
                </div>
                <div class="food-calories">${calories} kcal</div>
            `;
            foodsList.insertBefore(newFoodItem, foodsList.firstChild);
            
            updateCalorieDisplay();
            updateAITip();
            
            // é¡¯ç¤ºæœ€è¿‘é£Ÿç‰©å€åŸŸ
            document.getElementById('recentFoods').style.display = 'block';
        }

        // æª¢æŸ¥æ–°æ·»åŠ çš„é£Ÿç‰©
        function checkForNewFood() {
            const newFood = localStorage.getItem('newFood');
            if (newFood) {
                const foodData = JSON.parse(newFood);
                addFoodToLog(foodData.name, foodData.calories);
                localStorage.removeItem('newFood');
            }
        }

        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            checkProfileSetup();
            checkForNewFood();
            
            console.log('ğŸ æ¯æ—¥ç†±é‡ç²¾ç®—å¸«å·²å•Ÿå‹•ï¼');
            console.log('ğŸ“Š å¼•å°ç”¨æˆ¶è¨­å®šå€‹äººè³‡æ–™æµç¨‹å·²æº–å‚™å°±ç·’');
            console.log('ğŸ“¸ æ‹ç…§è­˜åˆ¥åŠŸèƒ½å·²æº–å‚™å°±ç·’');
        });

        // å¾æ‹ç…§é é¢è¿”å›æ™‚æ›´æ–°æ•¸æ“š
        window.addEventListener('storage', function(e) {
            if (e.key === 'newFood') {
                const foodData = JSON.parse(e.newValue);
                addFoodToLog(foodData.name, foodData.calories);
            }
        });
    </script>
</body>
</html>